riot.tag2("rgrid",'<query-condition if="{has_query}" rules="{query_rules}" url="{query_url}" ajax="{query_ajax}" fields="{query_fields}" layout="{query_layout}" data="{query_data}" field_options="{query_field_options}"></query-condition> <div if="{left_tools.length>0 || right_tools.length>0}" class="btn-toolbar"> <div if="{left_tools.length>0}" class="rgrid-tools pull-left"> <div each="{btn_group in left_tools}" class="{btn_group_class}"> <button each="{btn in btn_group}" data-is="rgrid-button" btn="{btn}"></button> </div> </div> <div if="{right_tools.length>0}" class="rgrid-tools pull-right"> <div each="{btn_group in right_tools}" class="{btn_group_class}"> <button each="{btn in btn_group}" data-is="rgrid-button" btn="{btn}"></button> </div> </div> </div> <yield></yield> <rtable cols="{cols}" options="{rtable_options}" data="{data}" start="{start}" observable="{observable}"></rtable> <div class="clearfix tools"> <pagination if="{pagination}" data="{data}" url="{url}" page="{page}" total="{total}" observable="{observable}" limit="{limit}" onpagechanged="{onpagechanged}" onbeforepage="{onbeforepage}" onlimit="{onlimit}" buttons="{footer_tools}" theme="{page_theme}"></pagination> <div if="{!pagination && footer_tools.length>0}" class="pull-right {btn_group_class}"> <button each="{btn in footer_tools}" data-is="rgrid-button" btn="{btn}"></button> </div> </div>','rgrid .rgrid-tools,[data-is="rgrid"] .rgrid-tools{margin-bottom:5px;padding-left:5px;} rgrid .btn-toolbar .btn-group,[data-is="rgrid"] .btn-toolbar .btn-group{margin-right:8px;}',"",function(t){var e=this;t.data?Array.isArray(t.data)?this.data=new DataSet(t.data):this.data=t.data:this.data=new DataSet,this.cols=t.cols,this.url=t.url;var o=new QueryString(this.url);this.observable=t.observable||riot.observable(),this.page=t.page||parseInt(o.get("page"))||1,this.limit=t.limit||10,this.limits=t.limits||[10,20,30,40,50],this.total=t.total||0,this.pagination=void 0==t.pagination||t.pagination,this.has_query=void 0!==t.query,this.query=t.query||{},this.query_rules=this.query.rules||{},this.query_fields=this.query.fields||[],this.query_layout=this.query.layout||[],this.query_data=this.query.data||{},this.query_url=t.query_url||this.url,this.query_field_options=this.query.field_options||{},this.query_ajax=t.query_ajax,this.start=(this.page-1)*this.limit,this.footer_tools=t.footer_tools||[],this.left_tools=t.left_tools||t.tools||[],this.right_tools=t.right_tools||[],this.btn_group_class=t.btn_group_class||"btn-group btn-group-sm",this.onLoaded=t.onLoaded,this.autoLoad=t.audoLoad||!0,this.onBeforePage=t.onBeforePage||function(t){return!0},this.page_theme=t.page_theme||"simple",this.onsort=function(t){var o;o=t.length>0?get_url(e.url,{sort:t[0].name+"."+t[0].direction}):get_url(e.url,{sort:""}),e.url=o,e.load(o,function(t){return t.rows})},this.onlimit=function(t){e.limit=t,e.start=(this.page-1)*this.limit,e.load()},this.onloaddata=function(o){var i={parent:o[t.idField||"id"]};$.getJSON(e.url,i).done(function(t){t.rows.length>0?e.data.add(t.rows,o):(o.has_children=!1,e.update())})},this.onbeforepage=function(t){var o=e.onBeforePage(t);return!!o&&(e.start=(t-1)*e.limit,e.page=t,!0)},this.rtable_options={theme:t.theme||"zebra",combineCols:t.combineCols,nameField:t.nameField||"name",labelField:t.labelField||"title",indexCol:t.indexCol,checkCol:t.checkCol,checkColTitle:t.checkColTitle,checkColWidth:t.checkColWidth,indexColFrozen:t.indexColFrozen,checkColFrozen:t.checkColFrozen,showSelected:t.showSelected,checkAll:t.checkAll,multiSelect:t.multiSelect,maxHeight:t.maxHeight,minHeight:t.minHeight,height:t.height,width:t.width,clickSelect:t.clickSelect,rowHeight:t.rowHeight,container:$(this.root).parent(),noData:t.noData,tree:t.tree,expanded:void 0===t.expanded||t.expanded,useFontAwesome:void 0===t.useFontAwesome||t.useFontAwesome,idField:t.idField,parentField:t.parentField,orderField:t.orderField,levelField:t.levelField,treeField:t.treeField,hasChildrenField:t.hasChildrenField,virtual:t.virtual,contextMenu:t.contextMenu,onDblclick:t.onDblclick,onClick:t.onClick,onMove:t.onMove,onEdit:t.onEdit,onEdited:t.onEdited,onSelect:t.onSelect,onDeselect:t.onDeselect,onSelected:t.onSelected,onDeselected:t.onDeselected,onLoadData:t.onLoadData||this.onloaddata,onSort:t.onSort||this.onsort,onCheckable:t.onCheckable,onRowClass:t.onRowClass,onEditable:t.onEditable,onInitData:t.onInitData,colspanValue:t.colspanValue,draggable:t.draggable,editable:t.editable,remoteSort:t.remoteSort},this.on("mount",function(){this.table=this.root.querySelector("rtable");for(var t,o,i=this.left_tools.concat(this.right_tools).concat([this.footer_tools]),a=0,l=i.length;a<l;a++){o=i[a];for(var s=0,n=o.length;s<n;s++){t=o[s];var r=function(t){return function(o){return t.onClick?t.onClick.call(e,o):void(t.url&&(window.location.href=t.url))}};t.onclick=r(t),t.disabled=function(t){return t.onDisabled?t.onDisabled.call(e):t.checkSelected?0==e.table.get_selected().length:void 0},t.class="btn "+(t.class||"btn-primary")}}this.root.add=this.table.add,this.root.addFirstChild=this.table.addFirstChild,this.root.update=this.table.update,this.root.remove=this.table.remove,this.root.get=this.table.get,this.root._get=this.table._get,this.root.load=this.load,this.root.insertBefore=this.table.insertBefore,this.root.insertAfter=this.table.insertAfter,this.root.get_selected=this.table.get_selected,this.root.expand=this.table.expand,this.root.collapse=this.table.collapse,this.root.is_selected=this.table.is_selected,this.root.move=this.table.move,this.root.save=this.table.save,this.root.diff=this.table.diff,this.root.getButton=this.getButton,this.root.refresh=this.update,this.root.select=this.table.select,this.root.deselect=this.table.deselect,this.root.set_selected=this.table.set_selected,this.root.resize=this.table.resize,this.root.instance=this,this.url&&this.autoLoad&&(this.table.show_loading(!0),setTimeout(function(){e.load(e.url)},100)),this.observable.on("selected",function(t){e.update()}),this.observable.on("deselected",function(t){e.update()}),e.data.on("*",function(t,o){e.pagination?"remove"==t?e.total-=o.items.length:"add"==t&&(e.total+=o.items.length):e.total=e.data.length})}),this.load=function(o,i){var a,o;i=i||{};var l=function(t){return t.rows};if(o){var s=new QueryString(e.url);e.limit=parseInt(s.urlParams.limit)||e.limit,e.page=parseInt(s.urlParams.page)||e.page}e.url=o||e.url,o=e.pagination?get_url(e.url,{limit:e.limit,page:e.page}):e.url,a=t.tree?e.data.load_tree(o,i,l):e.data.load(o,i,e.onLoaded||l),a.done(function(t){e.total=t.total,e.update(),e.data.save()})},this.getButton=function(t){return document.getElementById(t)}}),riot.tag2("rgrid-button",'<i if="{opts.btn.icon}" class="{opts.btn.icon}"></i> <span>{opts.btn.label}</span>',"",'class="{opts.btn.class}" id="{opts.btn.id}" type="button" disabled="{opts.btn.disabled ? opts.btn.disabled(btn) : false}" onclick="{opts.btn.onclick}"',function(t){});